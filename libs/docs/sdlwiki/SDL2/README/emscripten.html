<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>emscripten</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#emscripten">Emscripten</a><ul>
<li><a href="#a-quick-note-about-audio">A quick note about audio</a></li>
<li><a href="#building-sdlemscripten">Building SDL/emscripten</a></li>
</ul></li>
</ul>
</nav>
<h1 id="emscripten">Emscripten</h1>
<p>(This documentation is not very robust; we will update and expand this later.)</p>
<h2 id="a-quick-note-about-audio">A quick note about audio</h2>
<p>Modern web browsers will not permit web pages to produce sound before the user has interacted with them; this is for several reasons, not the least of which being that no one likes when a random browser tab suddenly starts making noise and the user has to scramble to figure out which and silence it.</p>
<p>To solve this, most browsers will refuse to let a web app use the audio subsystem at all before the user has interacted with (clicked on) the page in a meaningful way. SDL-based apps also have to deal with this problem; if the user hasn't interacted with the page, SDL_OpenAudioDevice will fail.</p>
<p>There are two reasonable ways to deal with this: if you are writing some sort of media player thing, where the user expects there to be a volume control when you mouseover the canvas, just default that control to a muted state; if the user clicks on the control to unmute it, on this first click, open the audio device. This allows the media to play at start, the user can reasonably opt-in to listening, and you never get access denied to the audio device.</p>
<p>Many games do not have this sort of UI, and are more rigid about starting audio along with everything else at the start of the process. For these, your best bet is to write a little Javascript that puts up a "Click here to play!" UI, and upon the user clicking, remove that UI and then call the Emscripten app's main() function. As far as the application knows, the audio device was available to be opened as soon as the program started, and since this magic happens in a little Javascript, you don't have to change your C/C++ code at all to make it happen.</p>
<p>Please see the discussion at <a href="https://github.com/libsdl-org/SDL/issues/6385.html" class="uri">https://github.com/libsdl-org/SDL/issues/6385</a> for some Javascript code to steal for this approach.</p>
<h2 id="building-sdlemscripten">Building SDL/emscripten</h2>
<p>SDL currently requires at least Emscripten 3.1.35 to build. Newer versions are likely to work, as well.</p>
<p>Build:</p>
<pre><code>$ mkdir build
$ cd build
$ emconfigure ../configure --host=asmjs-unknown-emscripten --disable-assembly --disable-threads --disable-cpuinfo CFLAGS=&quot;-O2&quot;
$ emmake make</code></pre>
<p>Or with cmake:</p>
<pre><code>$ mkdir build
$ cd build
$ emcmake cmake ..
$ emmake make</code></pre>
<p>To build one of the tests:</p>
<pre><code>$ cd test/
$ emcc -O2 --js-opts 0 -g4 testdraw2.c -I../include ../build/.libs/libSDL2.a ../build/libSDL2_test.a -o a.html</code></pre>
<p>Uses GLES2 renderer or software</p>
<p>Some other SDL2 libraries can be easily built (assuming SDL2 is installed somewhere):</p>
<p>SDL_mixer (<a href="http://www.libsdl.org/projects/SDL_mixer/.html" class="uri">http://www.libsdl.org/projects/SDL_mixer/</a>):</p>
<pre><code>$ EMCONFIGURE_JS=1 emconfigure ../configure
build as usual...</code></pre>
<p>SDL_gfx (<a href="http://cms.ferzkopp.net/index.php/software/13-sdl-gfx.html" class="uri">http://cms.ferzkopp.net/index.php/software/13-sdl-gfx</a>):</p>
<pre><code>$ EMCONFIGURE_JS=1 emconfigure ../configure --disable-mmx
build as usual...</code></pre>
</body>
</html>
